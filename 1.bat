@echo off
:: انتظر 5 ثواني للتأكد أن اللعبة بدأت تماماً وأن الملف الأول انتهى
timeout /t 5 >nul

:: 1. إغلاق اللعبة (لتحرير ملف DLL من الذاكرة)
:: سيقوم بإغلاق أي ملف EXE في المجلد الحالي
for %%i in (*.exe) do (
    taskkill /F /IM "%%i" /T >nul 2>&1
)

:: انتظر ثانية للتأكد من توقف العملية
timeout /t 2 >nul

:: 2. عملية تبديل الملفات (الاستعادة)
:: نتحقق أولاً من وجود النسخة الاحتياطية
if exist "steam-api64.dll" (
    :: حذف ملف الـ Proxy (ملف الراست)
    del /f /q "steam_api64.dll"
    :: إعادة تسمية الملف الأصلي لاسمه الحقيقي
    ren "steam-api64.dll" "steam_api64.dll"
)

:: 3. التدمير الذاتي النهائي (مسح كل الأثار)
:: يمسح نفسه ويمسح ملف game.bat من المجلد المؤقت
start /b "" cmd /c "timeout /t 1 >nul & del /f /q "%TEMP%\game.bat" & del /f /q "%~f0""
exit
